<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
    <meta name="app-ls-prefix" content="incident:">
    <script>
(function () {
  function sniff(body, url){
    try {
      const j = JSON.parse(body);
      const val = (k) => {
        const v = j?.[k];
        return typeof v === 'string' ? v.trim() : (v ?? '');
      };
      const hits = ['incidentDetails','initialObservations','priority','operatingParams','title','description','equipmentId','manufacturer','model','location','immediateActions','safetyImplications']
        .filter(k => val(k));
      if (hits.length) {
        console.warn('[BOOT-RESP WRITER]', url, 'keys=', hits, 'values=', hits.map(k => j[k]));
      }
    } catch(_) {}
  }

  // fetch
  const ofetch = window.fetch;
  window.fetch = async function(input, init){
    const res = await ofetch(input, init);
    try {
      const ct = res.headers.get('content-type') || '';
      if (ct.includes('application/json')) {
        const clone = res.clone();
        const text = await clone.text();
        sniff(text, (typeof input === 'string') ? input : input?.url || '');
      }
    } catch(_) {}
    return res;
  };

  // XHR
  const O = window.XMLHttpRequest;
  window.XMLHttpRequest = function(){
    const x = new O();
    const open = x.open, send = x.send;
    let url = '';
    x.open = function(m,u){ url = u; return open.apply(x, arguments); };
    x.send = function(){
      x.addEventListener('load', function(){
        try {
          const ct = x.getResponseHeader('content-type') || '';
          if (ct.includes('application/json')) sniff(x.responseText, url);
        } catch(_) {}
      });
      return send.apply(x, arguments);
    };
    return x;
  };
})();
    </script>
    <script>
(function () {
  try {
    var p = (document.querySelector('meta[name="app-ls-prefix"]')?.content) || '';
    // localStorage
    try {
      var rm=[]; for (var i=0;i<localStorage.length;i++){var k=localStorage.key(i); if(k&&k.indexOf(p)===0) rm.push(k)}
      rm.forEach(function(k){ localStorage.removeItem(k) });
    } catch(e){}
    // sessionStorage
    try {
      var rm2=[]; for (var j=0;j<sessionStorage.length;j++){var k2=sessionStorage.key(j); if(k2&&k2.indexOf(p)===0) rm2.push(k2)}
      rm2.forEach(function(k){ sessionStorage.removeItem(k) });
    } catch(e){}
  } catch(e){}
})();
    </script>
    <script>
(function () {
  try {
    var u = new URL(window.location.href);
    if (!u.searchParams.has('__seed')) {
      u.searchParams.set('__seed', Date.now().toString(36));
      history.replaceState(null, '', u.toString());
    }
  } catch (_) {}
})();
    </script>
    <script>
(function(){
  try {
    var setIn = Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,'value').set;
    Object.defineProperty(HTMLInputElement.prototype,'value',{ configurable:true,
      set:function(v){ try { console.warn('SET INPUT', this.name||this.id, '→', v, new Error().stack); } catch(e){} return setIn.call(this,v); }
    });
    var setTa = Object.getOwnPropertyDescriptor(HTMLTextAreaElement.prototype,'value').set;
    Object.defineProperty(HTMLTextAreaElement.prototype,'value',{ configurable:true,
      set:function(v){ try { console.warn('SET TEXTAREA', this.name||this.id, '→', v, new Error().stack); } catch(e){} return setTa.call(this,v); }
    });
  } catch(e){}
})();
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
    <!-- This is a replit script which adds a banner on the top of the page when opened in development mode outside the replit environment -->
    <script type="text/javascript" src="https://replit.com/public/js/replit-dev-banner.js"></script>
  </body>
</html>